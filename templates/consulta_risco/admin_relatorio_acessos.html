{% extends 'base.html' %}

{% block title %}Relat√≥rio de Acessos - Stigliani{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="admin-header">
        <div class="admin-header-content">
            <h1 class="admin-title">Relat√≥rio de Acessos</h1>
            <div class="admin-user-info">
                <span class="admin-welcome">An√°lise detalhada de tr√°fego do site</span>
            </div>
        </div>
        <div class="admin-actions">
            <a href="{% url 'admin_dashboard' %}" class="btn btn-secondary btn-small btn-header">
                ‚Üê Dashboard
            </a>
            <a href="{% url 'admin_logout' %}" class="btn btn-danger btn-small btn-header">
                üö™ Sair
            </a>
        </div>
    </div>

    {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="admin-content">
        <!-- Filtros -->
        <div class="admin-section">
            <div class="admin-section-header">
                <h2 class="admin-section-title">üîç Filtros de Busca</h2>
            </div>
            
            <form method="GET" class="search-form">
                {% csrf_token %}
                <div class="search-dates-group">
                    <div class="search-date-field">
                        <label for="data_inicio" class="search-date-label">
                            <span class="label-icon">üìÖ</span>
                            Data In√≠cio
                        </label>
                        <input type="date" 
                               id="data_inicio"
                               name="data_inicio" 
                               value="{{ data_inicio }}" 
                               class="search-date-input">
                    </div>
                    
                    <div class="search-date-field">
                        <label for="data_fim" class="search-date-label">
                            <span class="label-icon">üìÖ</span>
                            Data Fim
                        </label>
                        <input type="date" 
                               id="data_fim"
                               name="data_fim" 
                               value="{{ data_fim }}" 
                               class="search-date-input">
                    </div>
                </div>
                
                <div class="search-input-group">
                    <div class="search-input-wrapper">
                        <select name="estado" class="search-select">
                            <option value="">üåé Todos os Estados</option>
                            {% for estado in estados_disponiveis %}
                                <option value="{{ estado.sigla }}" {% if estado_filtro == estado.sigla %}selected{% endif %}>
                                    {{ estado.nome }}
                                </option>
                            {% endfor %}
                        </select>
                        <select name="cidade" id="cidade_select" class="search-select" {% if not estado_filtro %}disabled{% endif %}>
                            <option value="">üîç {% if estado_filtro %}Todas as Cidades{% else %}Selecione um estado primeiro{% endif %}</option>
                            {% if estado_filtro and cidades_disponiveis %}
                                {% for cidade in cidades_disponiveis %}
                                    <option value="{{ cidade }}" {% if cidade_filtro == cidade %}selected{% endif %}>
                                        {{ cidade }}
                                    </option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                    <div class="search-actions">
                        <button type="submit" class="btn btn-primary search-btn">
                            <span class="btn-icon">üîç</span>
                            Filtrar
                        </button>
                        {% if data_inicio or data_fim or estado_filtro or cidade_filtro %}
                            <a href="{% url 'admin_relatorio_acessos' %}" class="btn btn-secondary search-clear">
                                <span class="btn-icon">‚úï</span>
                                Limpar Filtros
                            </a>
                        {% endif %}
                    </div>
                </div>
            </form>
        </div>

        <!-- Estat√≠sticas Gerais -->
        <div class="admin-section admin-section-compact">
            <div class="admin-section-header">
                <h2 class="admin-section-title">üìà Vis√£o Geral</h2>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üëÅÔ∏è</div>
                    <div class="stat-content">
                        <div class="stat-number">{{ total_acessos|default:0 }}</div>
                        <div class="stat-label">Total de Acessos</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üìÑ</div>
                    <div class="stat-content">
                        <div class="stat-number">{{ paginas_mais_visitadas|length }}</div>
                        <div class="stat-label">P√°ginas √önicas</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üó∫Ô∏è</div>
                    <div class="stat-content">
                        <div class="stat-number">{{ acessos_por_estado|length }}</div>
                        <div class="stat-label">Estados</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üèôÔ∏è</div>
                    <div class="stat-content">
                        <div class="stat-number">{{ acessos_por_cidade|length }}</div>
                        <div class="stat-label">Cidades</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- P√°ginas Mais Visitadas -->
        <div class="admin-section">
            <div class="admin-section-header">
                <h2 class="admin-section-title">üìÑ P√°ginas Mais Visitadas</h2>
                <div class="section-badge">{{ paginas_mais_visitadas|length }} p√°ginas</div>
            </div>
            
            {% if paginas_mais_visitadas %}
                <div class="table-container">
                    <table class="data-table modern-table">
                        <thead>
                            <tr>
                                <th class="col-rank">#</th>
                                <th class="col-page">P√°gina</th>
                                <th class="col-url">URL</th>
                                <th class="col-views">Acessos</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pagina in paginas_mais_visitadas %}
                                <tr class="table-row-hover">
                                    <td class="text-center rank-cell">
                                        <span class="rank-badge rank-{{ forloop.counter }}">
                                            {% if forloop.counter == 1 %}ü•á
                                            {% elif forloop.counter == 2 %}ü•à
                                            {% elif forloop.counter == 3 %}ü•â
                                            {% else %}{{ forloop.counter }}
                                            {% endif %}
                                        </span>
                                    </td>
                                    <td class="page-cell">
                                        <strong class="page-name">{{ pagina.nome_pagina|default:pagina.url|truncatewords:5 }}</strong>
                                    </td>
                                    <td class="url-cell">
                                        <code class="url-code">{{ pagina.url|truncatechars:50 }}</code>
                                    </td>
                                    <td class="text-center views-cell">
                                        <span class="badge badge-primary badge-large">{{ pagina.total }}</span>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üìä</div>
                    <h3 class="empty-title">Nenhum acesso encontrado</h3>
                    <p class="empty-description">N√£o h√° acessos registrados no per√≠odo selecionado.</p>
                </div>
            {% endif %}
        </div>

        <!-- Acessos por Estado -->
        <div class="admin-section">
            <div class="admin-section-header">
                <h2 class="admin-section-title">üó∫Ô∏è Distribui√ß√£o por Estado</h2>
                <div class="section-badge">{{ acessos_por_estado|length }} estados</div>
            </div>
            
            {% if acessos_por_estado %}
                <div class="table-container">
                    <table class="data-table modern-table">
                        <thead>
                            <tr>
                                <th class="col-state">Estado</th>
                                <th class="col-views">Acessos</th>
                                <th class="col-percent">Percentual</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in acessos_por_estado %}
                                {% widthratio item.total total_acessos 100 as percent %}
                                <tr class="table-row-hover">
                                    <td class="state-cell">
                                        <div class="state-info">
                                            <span class="state-flag">üè≥Ô∏è</span>
                                            <strong class="state-name">{{ item.estado }}</strong>
                                        </div>
                                    </td>
                                    <td class="text-center views-cell">
                                        <span class="badge badge-primary badge-large">{{ item.total }}</span>
                                    </td>
                                    <td class="percent-cell">
                                        <div class="progress-wrapper">
                                            <div class="progress-bar-container">
                                                <div class="progress-bar progress-animated" 
                                                     style="width: {{ percent }}%"
                                                     data-percent="{{ percent }}"></div>
                                            </div>
                                            <span class="progress-percent">{{ percent }}%</span>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üó∫Ô∏è</div>
                    <h3 class="empty-title">Nenhum dado de localiza√ß√£o</h3>
                    <p class="empty-description">N√£o h√° dados de localiza√ß√£o dispon√≠veis no per√≠odo selecionado.</p>
                </div>
            {% endif %}
        </div>

        <!-- Acessos por Cidade -->
        <div class="admin-section">
            <div class="admin-section-header">
                <h2 class="admin-section-title">üèôÔ∏è Top Cidades</h2>
                <div class="section-badge">Top 50 cidades</div>
            </div>
            
            {% if acessos_por_cidade %}
                <div class="table-container">
                    <table class="data-table modern-table">
                        <thead>
                            <tr>
                                <th class="col-city">Cidade</th>
                                <th class="col-state">Estado</th>
                                <th class="col-views">Acessos</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in acessos_por_cidade %}
                                <tr class="table-row-hover">
                                    <td class="city-cell">
                                        <div class="city-info">
                                            <span class="city-icon">üèôÔ∏è</span>
                                            <strong class="city-name">{{ item.cidade }}</strong>
                                        </div>
                                    </td>
                                    <td class="state-cell-small">
                                        <span class="state-badge">{{ item.estado }}</span>
                                    </td>
                                    <td class="text-center views-cell">
                                        <span class="badge badge-primary badge-large">{{ item.total }}</span>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üèôÔ∏è</div>
                    <h3 class="empty-title">Nenhum dado de cidade</h3>
                    <p class="empty-description">N√£o h√° dados de cidade dispon√≠veis no per√≠odo selecionado.</p>
                </div>
            {% endif %}
        </div>

        <!-- Registros Individuais de Acesso -->
        <div class="admin-section">
            <div class="admin-section-header">
                <h2 class="admin-section-title">üìã Registros de Acesso</h2>
                <div class="header-actions">
                    <div class="section-badge">{{ total_acessos }} registros</div>
                    {% if total_acessos > 0 %}
                        <button type="button" 
                                class="btn btn-danger btn-delete-all" 
                                id="btn-excluir-todos"
                                title="Excluir todos os registros que correspondem aos filtros aplicados">
                            üóëÔ∏è Excluir Todos os Filtrados
                        </button>
                    {% endif %}
                </div>
            </div>
            
            {% if acessos_paginados %}
                <div class="table-container">
                    <table class="data-table modern-table">
                        <thead>
                            <tr>
                                <th class="col-date">Data/Hora</th>
                                <th class="col-page">P√°gina</th>
                                <th class="col-url">URL</th>
                                <th class="col-location">Localiza√ß√£o</th>
                                <th class="col-ip">IP</th>
                                <th class="col-actions">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for acesso in acessos_paginados %}
                                <tr class="table-row-hover" id="acesso-row-{{ acesso.id }}">
                                    <td class="date-cell">
                                        <span class="date-time">{{ acesso.data_acesso|date:"d/m/Y H:i" }}</span>
                                    </td>
                                    <td class="page-cell">
                                        <strong class="page-name">{{ acesso.nome_pagina|default:"-" }}</strong>
                                    </td>
                                    <td class="url-cell">
                                        <code class="url-code">{{ acesso.url|truncatechars:40 }}</code>
                                    </td>
                                    <td class="location-cell">
                                        {% if acesso.cidade and acesso.estado %}
                                            <span class="location-badge">{{ acesso.cidade }}, {{ acesso.estado }}</span>
                                        {% else %}
                                            <span class="location-badge location-unknown">N√£o identificado</span>
                                        {% endif %}
                                    </td>
                                    <td class="ip-cell">
                                        <code class="ip-code">{{ acesso.ip_address|default:"-" }}</code>
                                    </td>
                                    <td class="actions-cell">
                                        <button class="btn-delete-acesso" 
                                                data-acesso-id="{{ acesso.id }}"
                                                title="Excluir registro">
                                            üóëÔ∏è
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagina√ß√£o -->
                {% if acessos_paginados.has_other_pages %}
                    <div class="pagination-container">
                        <div class="pagination">
                            {% if acessos_paginados.has_previous %}
                                <a href="?page=1{% if data_inicio %}&data_inicio={{ data_inicio }}{% endif %}{% if data_fim %}&data_fim={{ data_fim }}{% endif %}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}{% if cidade_filtro %}&cidade={{ cidade_filtro }}{% endif %}" 
                                   class="pagination-link">¬´ Primeira</a>
                                <a href="?page={{ acessos_paginados.previous_page_number }}{% if data_inicio %}&data_inicio={{ data_inicio }}{% endif %}{% if data_fim %}&data_fim={{ data_fim }}{% endif %}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}{% if cidade_filtro %}&cidade={{ cidade_filtro }}{% endif %}" 
                                   class="pagination-link">‚Äπ Anterior</a>
                            {% endif %}
                            
                            <span class="pagination-info">
                                P√°gina {{ acessos_paginados.number }} de {{ acessos_paginados.paginator.num_pages }}
                            </span>
                            
                            {% if acessos_paginados.has_next %}
                                <a href="?page={{ acessos_paginados.next_page_number }}{% if data_inicio %}&data_inicio={{ data_inicio }}{% endif %}{% if data_fim %}&data_fim={{ data_fim }}{% endif %}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}{% if cidade_filtro %}&cidade={{ cidade_filtro }}{% endif %}" 
                                   class="pagination-link">Pr√≥xima ‚Ä∫</a>
                                <a href="?page={{ acessos_paginados.paginator.num_pages }}{% if data_inicio %}&data_inicio={{ data_inicio }}{% endif %}{% if data_fim %}&data_fim={{ data_fim }}{% endif %}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}{% if cidade_filtro %}&cidade={{ cidade_filtro }}{% endif %}" 
                                   class="pagination-link">√öltima ¬ª</a>
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üìã</div>
                    <h3 class="empty-title">Nenhum registro encontrado</h3>
                    <p class="empty-description">N√£o h√° registros de acesso no per√≠odo selecionado.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
/* Background azul marinho */
body {
    background: #1a2332 !important;
}

.admin-dashboard {
    background: #1a2332;
    min-height: 100vh;
}

.admin-content {
    background: #1a2332;
}

/* Melhorar contraste do admin-header */
.admin-header {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important;
    color: #ffffff !important;
    border: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    text-align: center;
    position: relative;
}

.admin-header-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.admin-title {
    color: #ffffff !important;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    text-align: center;
    margin: 0;
}

.admin-welcome {
    color: rgba(255, 255, 255, 0.95) !important;
    font-weight: 500;
    text-align: center;
}

.admin-actions {
    position: absolute;
    top: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
}

.admin-header .btn-header {
    background: rgba(255, 255, 255, 0.15) !important;
    color: #ffffff !important;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    padding: 0.4rem 0.75rem !important;
    font-size: 0.8rem !important;
    min-height: auto !important;
    height: auto !important;
}

.admin-header .btn-header:hover {
    background: rgba(255, 255, 255, 0.25) !important;
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.admin-header .btn-header.btn-danger {
    background: rgba(220, 53, 69, 0.8) !important;
    border-color: rgba(220, 53, 69, 0.9);
}

.admin-header .btn-header.btn-danger:hover {
    background: rgba(220, 53, 69, 1) !important;
    border-color: #dc3545;
}

@media (max-width: 768px) {
    .admin-actions {
        position: static;
        margin-top: 1rem;
        justify-content: center;
    }
    
    .admin-header-content {
        margin-bottom: 0;
    }
}

/* Estat√≠sticas - mantendo cores do site */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
}

.stat-card {
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    border: none;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    background: #2d3a4e;
    color: white;
    padding: 1.5rem;
    border-radius: 12px;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    background: #34495e;
}

.stat-icon {
    color: var(--cor-laranja);
    font-size: 2.5rem;
}

.stat-number {
    color: white;
    font-weight: 700;
}

.stat-label {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
}

@media (max-width: 1024px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
}

/* Section badges */
.section-badge {
    background: var(--cor-laranja);
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

/* T√≠tulos e textos para melhor contraste no background azul marinho */
.admin-section-title {
    color: #ffffff !important;
}

.admin-section {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.admin-section-header {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

/* Estiliza√ß√£o melhorada dos Filtros de Busca */
.search-form {
    background: rgba(255, 255, 255, 0.03);
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.search-date-label {
    color: #ffffff !important;
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.label-icon {
    font-size: 1.1rem;
}

.search-date-input,
.search-input,
.search-select {
    background: rgba(255, 255, 255, 0.95) !important;
    border: 2px solid rgba(255, 255, 255, 0.2) !important;
    color: var(--cor-azul-escuro) !important;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-size: 0.95rem;
    transition: all 0.3s ease;
}

.search-date-input:focus,
.search-input:focus,
.search-select:focus {
    outline: none;
    border-color: var(--cor-laranja) !important;
    box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
    background: #ffffff !important;
}

.search-date-input::placeholder,
.search-input::placeholder {
    color: rgba(0, 0, 0, 0.5);
}

.search-dates-group {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.search-date-field {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.search-input-group {
    display: flex;
    gap: 1rem;
    align-items: flex-end;
    flex-wrap: wrap;
}

.search-input-wrapper {
    flex: 1;
    display: flex;
    gap: 1rem;
    min-width: 300px;
}

.search-actions {
    display: flex;
    gap: 0.75rem;
    align-items: center;
}

.search-btn {
    padding: 0.5rem 1rem !important;
    font-size: 0.85rem !important;
    min-height: auto !important;
    height: auto !important;
    white-space: nowrap;
}

.search-btn .btn-icon {
    margin-right: 0.4rem;
    font-size: 0.9rem;
}

.search-clear {
    padding: 0.5rem 1rem !important;
    font-size: 0.85rem !important;
    min-height: auto !important;
    height: auto !important;
    white-space: nowrap;
}

.search-clear .btn-icon {
    margin-right: 0.4rem;
    font-size: 0.9rem;
}

@media (max-width: 768px) {
    .search-dates-group {
        grid-template-columns: 1fr;
    }
    
    .search-input-wrapper {
        flex-direction: column;
        min-width: 100%;
    }
    
    .search-actions {
        width: 100%;
        justify-content: flex-start;
    }
}

.modern-table td {
    color: #ffffff;
}

.modern-table tbody tr {
    background: rgba(255, 255, 255, 0.02);
}

.modern-table tbody tr:hover {
    background: rgba(255, 107, 53, 0.15);
}

/* Tabelas modernas */
.modern-table {
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.modern-table thead {
    background: linear-gradient(135deg, var(--cor-azul-escuro) 0%, #2c3e50 100%);
    color: white;
}

.modern-table th {
    padding: 1.25rem 1rem;
    text-align: left;
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: none;
}

.modern-table td {
    padding: 1rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    vertical-align: middle;
}

.modern-table tbody tr {
    transition: all 0.2s ease;
}

.table-row-hover:hover {
    background: linear-gradient(90deg, rgba(255, 107, 53, 0.08) 0%, rgba(255, 107, 53, 0.02) 100%);
    transform: scale(1.01);
}

/* Rank badges */
.rank-cell {
    width: 60px;
}

.rank-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-weight: 700;
    font-size: 1rem;
}

.rank-1 {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
}

.rank-2 {
    background: linear-gradient(135deg, #C0C0C0 0%, #A0A0A0 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(192, 192, 192, 0.4);
}

.rank-3 {
    background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(205, 127, 50, 0.4);
}

.rank-badge:not(.rank-1):not(.rank-2):not(.rank-3) {
    background: var(--cor-cinza-claro);
    color: var(--cor-azul-escuro);
}

/* Page cell */
.page-cell {
    min-width: 200px;
}

.page-name {
    color: #ffffff;
    font-size: 0.95rem;
}

.url-cell {
    max-width: 300px;
}

.url-code {
    background: rgba(255, 107, 53, 0.2);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    color: #ffffff;
    word-break: break-all;
}

/* State info */
.state-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.state-flag {
    font-size: 1.2rem;
}

.state-name {
    color: #ffffff;
    font-size: 1rem;
}

.state-badge {
    display: inline-block;
    background: var(--cor-laranja);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 600;
}

/* City info */
.city-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.city-icon {
    font-size: 1.2rem;
}

.city-name {
    color: #ffffff;
    font-size: 0.95rem;
}

/* Badges melhorados */
.badge-large {
    padding: 0.5rem 1rem;
    font-size: 1rem;
    font-weight: 700;
    box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
}

/* Progress bar melhorado */
.progress-wrapper {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.progress-bar-container {
    flex: 1;
    position: relative;
    height: 28px;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 14px;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--cor-laranja) 0%, #ff8c5a 50%, #ffa87a 100%);
    border-radius: 14px;
    position: relative;
    transition: width 0.6s ease;
    box-shadow: 0 2px 8px rgba(255, 107, 53, 0.4);
}

.progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.progress-animated {
    animation: progressFill 1s ease-out;
}

@keyframes progressFill {
    from { width: 0; }
}

.progress-percent {
    min-width: 50px;
    text-align: right;
    font-weight: 700;
    color: #ffffff;
    font-size: 0.9rem;
}

/* Label com √≠cone */
.label-icon {
    margin-right: 0.5rem;
}

/* Bot√µes melhorados */
.btn-icon {
    margin-right: 0.5rem;
}

/* Empty state melhorado */
.empty-state {
    padding: 4rem 2rem;
    text-align: center;
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.05) 0%, rgba(255, 107, 53, 0.02) 100%);
    border-radius: 12px;
    border: 2px dashed rgba(255, 107, 53, 0.3);
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-title {
    color: #ffffff;
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.empty-description {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1rem;
}

/* Responsividade */
@media (max-width: 768px) {
    .modern-table {
        font-size: 0.85rem;
    }
    
    .modern-table th,
    .modern-table td {
        padding: 0.75rem 0.5rem;
    }
    
    .progress-wrapper {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .progress-percent {
        text-align: center;
        width: 100%;
    }
    
    .url-code {
        font-size: 0.75rem;
    }
}

/* Anima√ß√µes de entrada */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.admin-section {
    animation: fadeInUp 0.5s ease-out;
}

.admin-section:nth-child(1) { animation-delay: 0.1s; }
.admin-section:nth-child(2) { animation-delay: 0.2s; }
.admin-section:nth-child(3) { animation-delay: 0.3s; }
.admin-section:nth-child(4) { animation-delay: 0.4s; }

/* Estilos para bot√£o de exclus√£o */
.btn-delete-acesso {
    background: rgba(220, 53, 69, 0.8);
    color: white;
    border: none;
    padding: 0.4rem 0.6rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.btn-delete-acesso:hover {
    background: rgba(220, 53, 69, 1);
    transform: scale(1.1);
    box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4);
}

.btn-delete-acesso:active {
    transform: scale(0.95);
}

/* Bot√£o para excluir todos os registros filtrados */
.btn-delete-all {
    background: rgba(220, 53, 69, 0.9);
    color: white;
    border: 1px solid rgba(220, 53, 69, 1);
    padding: 0.6rem 1.2rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
}

.btn-delete-all:hover {
    background: rgba(220, 53, 69, 1);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
}

.btn-delete-all:active {
    transform: translateY(0);
}

.btn-delete-all:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

/* Estilos para c√©lulas da tabela de registros */
.date-cell {
    min-width: 140px;
}

.date-time {
    color: #ffffff;
    font-size: 0.9rem;
    font-weight: 500;
}

.location-cell {
    min-width: 150px;
}

.location-badge {
    display: inline-block;
    background: rgba(255, 107, 53, 0.2);
    color: #ffffff;
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 500;
}

.location-unknown {
    background: rgba(128, 128, 128, 0.2);
    color: rgba(255, 255, 255, 0.7);
}

.ip-cell {
    min-width: 120px;
}

.ip-code {
    background: rgba(255, 107, 53, 0.15);
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-size: 0.8rem;
    color: #ffffff;
    font-family: 'Courier New', monospace;
}

.actions-cell {
    width: 80px;
    text-align: center;
}

.col-actions {
    width: 80px;
    text-align: center;
}

/* Pagina√ß√£o */
.pagination-container {
    margin-top: 2rem;
    display: flex;
    justify-content: center;
}

.pagination {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.pagination-link {
    background: rgba(255, 255, 255, 0.1);
    color: #ffffff;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.pagination-link:hover {
    background: rgba(255, 107, 53, 0.3);
    border-color: var(--cor-laranja);
    transform: translateY(-2px);
}

.pagination-info {
    color: #ffffff;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    font-weight: 500;
}

@media (max-width: 768px) {
    .modern-table {
        font-size: 0.8rem;
    }
    
    .date-cell,
    .location-cell,
    .ip-cell {
        min-width: auto;
    }
    
    .pagination {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .pagination-link {
        width: 100%;
        text-align: center;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Obter CSRF token
    function getCSRFToken() {
        const token = document.querySelector('[name=csrfmiddlewaretoken]');
        if (token) {
            return token.value;
        }
        // Tentar obter do cookie
        const name = 'csrftoken';
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    const estadoSelect = document.querySelector('select[name="estado"]');
    const cidadeSelect = document.getElementById('cidade_select');
    
    if (estadoSelect && cidadeSelect) {
        estadoSelect.addEventListener('change', function() {
            const estadoSigla = this.value;
            
            // Limpar cidade selecionada
            cidadeSelect.innerHTML = '<option value="">üîç Carregando cidades...</option>';
            cidadeSelect.disabled = true;
            
            if (!estadoSigla) {
                cidadeSelect.innerHTML = '<option value="">üîç Todas as Cidades</option>';
                cidadeSelect.disabled = false;
                return;
            }
            
            // Buscar cidades via AJAX
            fetch(`/api/cidades-acessos/?estado=${estadoSigla}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    cidadeSelect.innerHTML = '<option value="">üîç Todas as Cidades</option>';
                    
                    if (data && data.length > 0) {
                        data.forEach(function(cidade) {
                            const option = document.createElement('option');
                            option.value = cidade.nome;
                            option.textContent = cidade.nome;
                            cidadeSelect.appendChild(option);
                        });
                        console.log(`Cidades carregadas para ${estadoSigla}: ${data.length}`);
                    } else {
                        const option = document.createElement('option');
                        option.value = '';
                        option.textContent = 'Nenhuma cidade encontrada para este estado';
                        cidadeSelect.appendChild(option);
                        console.log(`Nenhuma cidade encontrada para o estado ${estadoSigla}`);
                    }
                    
                    cidadeSelect.disabled = false;
                })
                .catch(error => {
                    console.error('Erro ao carregar cidades:', error);
                    cidadeSelect.innerHTML = '<option value="">üîç Erro ao carregar cidades</option>';
                    cidadeSelect.disabled = false;
                });
        });
    }
    
    // Funcionalidade de exclus√£o de registros
    document.querySelectorAll('.btn-delete-acesso').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const acessoId = this.getAttribute('data-acesso-id');
            const row = document.getElementById('acesso-row-' + acessoId);
            
            if (!confirm('Tem certeza que deseja excluir este registro de acesso?')) {
                return;
            }
            
            // Desabilitar bot√£o durante a requisi√ß√£o
            this.disabled = true;
            this.style.opacity = '0.5';
            
            // Obter CSRF token
            const csrftoken = getCSRFToken();
            
            // Fazer requisi√ß√£o AJAX
            fetch(`/painel/acesso/excluir/${acessoId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Mostrar mensagem de sucesso
                    showMessage(data.message || 'Registro exclu√≠do do banco de dados com sucesso!', 'success');
                    
                    // Se a resposta indicar que deve recarregar, recarregar a p√°gina
                    // Isso garante que as estat√≠sticas sejam atualizadas
                    if (data.reload) {
                        // Recarregar a p√°gina ap√≥s 1 segundo para atualizar todas as estat√≠sticas
                        setTimeout(function() {
                            window.location.reload();
                        }, 1000);
                    } else {
                        // Remover linha da tabela com anima√ß√£o (fallback se n√£o recarregar)
                        row.style.transition = 'opacity 0.3s ease';
                        row.style.opacity = '0';
                        setTimeout(function() {
                            row.remove();
                            
                            // Atualizar contador se existir
                            const badge = document.querySelector('.section-badge');
                            if (badge) {
                                const currentCount = parseInt(badge.textContent.match(/\d+/)[0]);
                                badge.textContent = (currentCount - 1) + ' registros';
                            }
                        }, 300);
                    }
                } else {
                    alert('Erro ao excluir registro: ' + (data.error || 'Erro desconhecido'));
                    this.disabled = false;
                    this.style.opacity = '1';
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao excluir registro. Tente novamente.');
                this.disabled = false;
                this.style.opacity = '1';
            });
        });
    });
    
    // Fun√ß√£o para mostrar mensagens
    function showMessage(message, type) {
        const messagesContainer = document.querySelector('.messages-container');
        if (!messagesContainer) {
            // Criar container se n√£o existir
            const container = document.createElement('div');
            container.className = 'messages-container';
            document.querySelector('.admin-content').insertBefore(container, document.querySelector('.admin-content').firstChild);
        }
        
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-' + (type === 'success' ? 'success' : 'error');
        alertDiv.textContent = message;
        document.querySelector('.messages-container').appendChild(alertDiv);
        
        // Remover mensagem ap√≥s 5 segundos
        setTimeout(function() {
            alertDiv.style.transition = 'opacity 0.3s ease';
            alertDiv.style.opacity = '0';
            setTimeout(function() {
                alertDiv.remove();
            }, 300);
        }, 5000);
    }
    
    // Funcionalidade para excluir todos os registros filtrados
    const btnExcluirTodos = document.getElementById('btn-excluir-todos');
    if (btnExcluirTodos) {
        btnExcluirTodos.addEventListener('click', function() {
            // Obter valores dos filtros do formul√°rio
            const form = document.querySelector('.search-form');
            const formData = new FormData(form);
            
            // Obter valores dos filtros
            const dataInicio = formData.get('data_inicio') || '';
            const dataFim = formData.get('data_fim') || '';
            const estado = formData.get('estado') || '';
            const cidade = formData.get('cidade') || '';
            
            // Contar quantos registros ser√£o exclu√≠dos (usar o total_acessos do template)
            const totalAcessos = {{ total_acessos|default:0 }};
            
            // Mensagem de confirma√ß√£o
            let mensagemConfirmacao = 'ATEN√á√ÉO: Esta a√ß√£o n√£o pode ser desfeita!\n\n';
            mensagemConfirmacao += `Voc√™ est√° prestes a excluir ${totalAcessos} registro(s) de acesso`;
            
            if (dataInicio || dataFim || estado || cidade) {
                mensagemConfirmacao += ' que correspondem aos filtros aplicados:\n\n';
                if (dataInicio) mensagemConfirmacao += `‚Ä¢ Data in√≠cio: ${dataInicio}\n`;
                if (dataFim) mensagemConfirmacao += `‚Ä¢ Data fim: ${dataFim}\n`;
                if (estado) mensagemConfirmacao += `‚Ä¢ Estado: ${estado}\n`;
                if (cidade) mensagemConfirmacao += `‚Ä¢ Cidade: ${cidade}\n`;
            } else {
                mensagemConfirmacao += ' (TODOS os registros, pois nenhum filtro est√° aplicado)';
            }
            
            mensagemConfirmacao += '\n\nTem CERTEZA ABSOLUTA que deseja continuar?';
            
            if (!confirm(mensagemConfirmacao)) {
                return;
            }
            
            // Segunda confirma√ß√£o para seguran√ßa
            if (!confirm('√öLTIMA CONFIRMA√á√ÉO: Voc√™ realmente deseja excluir TODOS estes registros?\n\nEsta a√ß√£o √© IRREVERS√çVEL!')) {
                return;
            }
            
            // Desabilitar bot√£o durante a requisi√ß√£o
            this.disabled = true;
            this.style.opacity = '0.6';
            const textoOriginal = this.textContent;
            this.textContent = '‚è≥ Excluindo...';
            
            // Obter CSRF token
            const csrftoken = getCSRFToken();
            
            // Criar FormData para enviar os filtros
            const deleteFormData = new FormData();
            deleteFormData.append('data_inicio', dataInicio);
            deleteFormData.append('data_fim', dataFim);
            deleteFormData.append('estado', estado);
            deleteFormData.append('cidade', cidade);
            
            // Fazer requisi√ß√£o AJAX
            fetch('/painel/acesso/excluir-todos-filtrados/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                },
                body: deleteFormData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const mensagem = data.message || `${data.total_excluidos || data.total_realmente_excluido || 0} registro(s) exclu√≠do(s) do banco de dados com sucesso!`;
                    showMessage(mensagem, 'success');
                    
                    // Recarregar a p√°gina ap√≥s 1.5 segundos para atualizar todas as estat√≠sticas
                    // Isso garante que as stats grids sejam recalculadas com os dados atualizados do banco
                    setTimeout(function() {
                        window.location.reload();
                    }, 1500);
                } else {
                    alert('Erro ao excluir registros: ' + (data.error || 'Erro desconhecido'));
                    this.disabled = false;
                    this.style.opacity = '1';
                    this.textContent = textoOriginal;
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao excluir registros. Tente novamente.');
                this.disabled = false;
                this.style.opacity = '1';
                this.textContent = textoOriginal;
            });
        });
    }
});
</script>
{% endblock %}
