{% extends 'base.html' %}

{% block title %}Sistema Temporariamente IndisponÃ­vel - Stigliani{% endblock %}

{% block content %}
<div class="maintenance-container">
    <div class="maintenance-card">
        <div class="maintenance-icon">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z" fill="var(--cor-laranja)"/>
                <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z" stroke="var(--cor-azul-escuro)" stroke-width="2"/>
            </svg>
        </div>
        
        <h1 class="maintenance-title">Sistema Temporariamente IndisponÃ­vel</h1>
        
        <div class="maintenance-message">
            <p class="maintenance-text">
                <strong>Estamos enfrentando instabilidade.</strong><br>
                Em breve retornaremos.
            </p>
        </div>
        
        <div class="maintenance-details">
            <p>Nossa equipe estÃ¡ trabalhando para resolver os problemas tÃ©cnicos e restaurar o serviÃ§o o mais rÃ¡pido possÃ­vel.</p>
            <p>Agradecemos sua compreensÃ£o e paciÃªncia.</p>
        </div>
        
        <div class="maintenance-actions">
            <button class="btn btn-secondary" id="btn-tentar-novamente" onclick="tentarAcessarHome()">
                <span class="btn-text">Tentar Novamente</span>
                <span class="btn-icon">ğŸ”„</span>
            </button>
        </div>
        
        <div class="maintenance-footer">
            <p class="maintenance-contact">
                Para suporte urgente, entre em contato: 
                <a href="mailto:atendimento@safetyscorebrasil.com.br">atendimento@safetyscorebrasil.com.br</a>
            </p>
        </div>
    </div>
</div>

<script>
function tentarAcessarHome() {
    const btn = document.getElementById('btn-tentar-novamente');
    const btnText = btn.querySelector('.btn-text');
    const btnIcon = btn.querySelector('.btn-icon');
    
    // Desabilitar botÃ£o e mostrar loading
    btn.disabled = true;
    btnText.textContent = 'Verificando...';
    btnIcon.textContent = 'â³';
    
    // Fazer requisiÃ§Ã£o para verificar se a home estÃ¡ funcionando
    fetch('{% url "home" %}', {
        method: 'GET',
        redirect: 'follow',
        credentials: 'same-origin'
    })
    .then(response => {
        // Verificar a URL final apÃ³s seguir redirecionamentos
        const finalUrl = response.url || window.location.href;
        
        // Se a URL final contÃ©m /maintenance/, ainda estÃ¡ em manutenÃ§Ã£o
        if (finalUrl.includes('/maintenance/')) {
            // Ainda estÃ¡ em manutenÃ§Ã£o
            btnText.textContent = 'Ainda em ManutenÃ§Ã£o';
            btnIcon.textContent = 'âš ï¸';
            
            setTimeout(() => {
                btnText.textContent = 'Tentar Novamente';
                btnIcon.textContent = 'ğŸ”„';
                btn.disabled = false;
            }, 2000);
        } else if (response.ok || response.status === 200) {
            // Verificar o conteÃºdo da resposta para garantir que nÃ£o Ã© a pÃ¡gina de manutenÃ§Ã£o
            return response.text().then(html => {
                // Se o HTML contÃ©m indicadores da pÃ¡gina de manutenÃ§Ã£o, ainda estÃ¡ em manutenÃ§Ã£o
                if (html.includes('Sistema Temporariamente IndisponÃ­vel') || 
                    html.includes('maintenance-container')) {
                    btnText.textContent = 'Ainda em ManutenÃ§Ã£o';
                    btnIcon.textContent = 'âš ï¸';
                    
                    setTimeout(() => {
                        btnText.textContent = 'Tentar Novamente';
                        btnIcon.textContent = 'ğŸ”„';
                        btn.disabled = false;
                    }, 2000);
                } else {
                    // Home estÃ¡ funcionando, redirecionar
                    window.location.href = '{% url "home" %}';
                }
            });
        } else {
            // Erro ou status inesperado
            btnText.textContent = 'Ainda IndisponÃ­vel';
            btnIcon.textContent = 'âš ï¸';
            
            setTimeout(() => {
                btnText.textContent = 'Tentar Novamente';
                btnIcon.textContent = 'ğŸ”„';
                btn.disabled = false;
            }, 2000);
        }
    })
    .catch(error => {
        // Erro na requisiÃ§Ã£o (rede, CORS, etc.)
        console.error('Erro ao verificar home:', error);
        btnText.textContent = 'Ainda IndisponÃ­vel';
        btnIcon.textContent = 'âš ï¸';
        
        setTimeout(() => {
            btnText.textContent = 'Tentar Novamente';
            btnIcon.textContent = 'ğŸ”„';
            btn.disabled = false;
        }, 2000);
    });
}
</script>
{% endblock %}


























































